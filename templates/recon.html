{% extends "layout.html" %}
{% block content %}
<div class="hex-container" style="margin-bottom: 30px;">
    <h2><span style="color: var(--hex-gold);">OPPONENT SCOUTING:</span> Automated Recon</h2>
    <form method="POST" style="display: flex; gap: 15px;">
        <select name="team_id" class="btn-hex" style="flex-grow: 1;">
            {% for team in opponents %}
                <option value="{{ team.id }}">{{ team.name }}</option>
            {% endfor %}
        </select>
        <button type="submit" class="btn-hex">Scour Opponent</button>
    </form>
</div>

{% if report %}
    {% if report.error %}
        <div class="hex-container"><p style="color: #ff4444;">{{ report.error }}</p></div>
    {% else %}
        <div style="display: grid; grid-template-columns: 1.5fr 1fr; gap: 20px; margin-bottom: 20px;">
            <div class="hex-container" style="border-left: 5px solid var(--hex-gold);">
                <h3 style="color: var(--hex-gold);">HOW TO WIN: COUNTER-STRATEGY</h3>
                {% for rec in report.recommendations %}
                    <div style="background: rgba(200,170,110,0.1); padding: 12px; margin-bottom: 10px; border-radius: 4px;">
                        {{ rec | safe }}
                    </div>
                {% endfor %}
            </div>
            
            <div class="hex-container">
                <h3>MOST PLAYED COMPS</h3>
                {% for hero, count in report.common_comps.items() %}
                    <div style="display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid #333;">
                        <span>{{ hero }}</span> 
                        <span style="color: var(--hex-teal);">{{ count }} Games</span>
                    </div>
                {% endfor %}
            </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
            <div class="hex-container">
                <h3>EXECUTION PROFILE</h3>
                <div id="radar-chart" style="height: 300px;"></div>
            </div>
            <div class="hex-container">
                <h3>MACRO TENDENCIES</h3>
                <p><strong>Game Style:</strong> {{ report.macro.style }}</p>
                <p><strong>Avg Lead @ 15m:</strong> {{ report.macro.gd15 }}g</p>
                <hr style="border-color: #333;">
                <p><small>Based on last 10 series found in GRID historical data.</small></p>
            </div>
        </div>

        <div class="hex-container">
            <h3 style="color: var(--hex-teal);">TARGET INTEL: PLAYER HABITS</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px;">
                {% for p in report.player_stats %}
                <div style="background: rgba(0,0,0,0.2); padding: 15px; border: 1px solid #444; text-align: center; border-radius: 8px;">
                    <div style="color: var(--hex-gold); font-weight: bold; font-size: 1.1em;">{{ p.name }}</div>
                    <div style="margin: 8px 0; font-size: 0.9em;">Prefers: <strong>{{ p.top_hero }}</strong></div>
                    <span style="font-size: 0.8em; padding: 2px 8px; border-radius: 10px; background: {{ '#442222' if 'Priority' in p.habit else '#224422' }};">
                        {{ p.habit }}
                    </span>
                </div>
                {% endfor %}
            </div>
        </div>

        <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
        <script>
            var graph = {{ report.charts.radar_chart | safe }};
            Plotly.newPlot('radar-chart', graph.data, graph.layout);
        </script>
    {% endif %}
{% endif %}
<script src="{{ url_for('static', filename='js/recon.js') }}"></script>
{% endblock %}




    

